# üîß INVENTAIRE BACKEND COMPLET - PHP MIGRATION REFERENCE

## üéØ Vue d'ensemble
- **Total fichiers TypeScript**: 17 fichiers
- **Total endpoints API**: 107 routes RESTful
- **Framework actuel**: Express.js + TypeScript + Node.js
- **ORM**: Drizzle ORM avec PostgreSQL
- **Validation**: Zod schemas partag√©s
- **Architecture**: Interface storage + impl√©mentation MemStorage
- **S√©curit√©**: Helmet + bcrypt + sessions + rate limiting

---

## üèóÔ∏è ARCHITECTURE BACKEND

### üîó Point d'entr√©e principal
- **`server/index.ts`**: Bootstrap Express, middleware s√©curit√©, routing, configuration
- **`server/routes/index.ts`**: Registration de tous les modules de routes

### üîß Configuration
- **`server/config.ts`**: Configuration serveur et variables d'environnement
- **`server/db.ts`**: Configuration base de donn√©es Drizzle ORM
- **`server/vite.ts`**: Int√©gration Vite pour d√©veloppement

---

## üìä SCH√âMA DE BASE DE DONN√âES

### üóÉÔ∏è Tables principales (shared/schema.ts)
**13 tables principales avec relations**

1. **users** - Gestion utilisateurs
   - **Champs**: id, username, password, name, role, avatar, employeeId, department, position, isActive, phone, email, createdAt, updatedAt
   - **Relations**: Messages, √©v√©nements, formations, permissions

2. **announcements** - Annonces entreprise
   - **Champs**: id, title, content, type, authorId, authorName, imageUrl, icon, createdAt, isImportant
   - **Types**: info, important, event, formation

3. **documents** - Gestion documentaire
   - **Champs**: id, title, description, category, fileName, fileUrl, updatedAt, version
   - **Cat√©gories**: regulation, policy, guide, procedure

4. **events** - √âv√©nements et calendrier
   - **Champs**: id, title, description, date, location, type, organizerId, createdAt
   - **Types**: meeting, training, social, other

5. **messages** - Messagerie interne
   - **Champs**: id, senderId, recipientId, subject, content, isRead, createdAt
   - **Relations**: Users (sender/recipient)

6. **complaints** - Syst√®me de r√©clamations
   - **Champs**: id, submitterId, assignedToId, title, description, category, priority, status, createdAt, updatedAt
   - **Workflow**: open ‚Üí in_progress ‚Üí resolved ‚Üí closed

7. **permissions** - Syst√®me de permissions
   - **Champs**: id, userId, grantedBy, permission, createdAt
   - **Types**: manage_announcements, manage_documents, manage_events, manage_users, validate_topics, validate_posts, manage_employee_categories, manage_trainings

8. **contents** - Biblioth√®que de contenu
   - **Champs**: id, title, type, category, description, fileUrl, thumbnailUrl, duration, viewCount, rating, tags, isPopular, isFeatured, createdAt, updatedAt
   - **Types**: video, image, document, audio

9. **categories** - Cat√©gories de contenu
   - **Champs**: id, name, description, icon, color, isVisible, sortOrder, createdAt

10. **employeeCategories** - Cat√©gories d'employ√©s
    - **Champs**: id, name, description, color, permissions, isActive, createdAt

11. **systemSettings** - Param√®tres syst√®me
    - **Champs**: id, showAnnouncements, showContent, showDocuments, showForum, showMessages, showComplaints, showTraining, updatedAt

12. **trainings** - Formations
    - **Champs**: id, title, description, category, difficulty, duration, instructorId, instructorName, startDate, endDate, location, maxParticipants, currentParticipants, isMandatory, isActive, isVisible, thumbnailUrl, documentUrls, createdAt, updatedAt

13. **trainingParticipants** - Participants formations
    - **Champs**: id, trainingId, userId, registeredAt, status, completionDate, score, feedback

### üéì E-Learning Extension (8 tables suppl√©mentaires)
1. **courses** - Cours e-learning
2. **lessons** - Le√ßons de cours
3. **quizzes** - Quiz et √©valuations
4. **enrollments** - Inscriptions cours
5. **lessonProgress** - Progression le√ßons
6. **quizAttempts** - Tentatives de quiz
7. **certificates** - Certificats obtenus
8. **resources** - Ressources p√©dagogiques

### üó£Ô∏è Forum System (4 tables)
1. **forumCategories** - Cat√©gories forum
2. **forumTopics** - Sujets de discussion
3. **forumPosts** - Messages forum
4. **forumLikes** - Likes sur posts

---

## üõ£Ô∏è SYST√àME DE ROUTES

### üìÅ Modules de routes (6 modules)

#### üîê Auth Routes (server/routes/auth.ts)
**6 endpoints d'authentification**
1. **POST /api/auth/login** - Connexion utilisateur
2. **POST /api/auth/register** - Inscription utilisateur
3. **POST /api/auth/logout** - D√©connexion
4. **GET /api/auth/me** - Profil utilisateur connect√©
5. **POST /api/auth/change-password** - Changement mot de passe
6. **POST /api/auth/forgot-password** - Mot de passe oubli√©

#### üë• Users Routes (server/routes/users.ts)
**12 endpoints de gestion utilisateurs**
1. **GET /api/users** - Liste tous les utilisateurs
2. **GET /api/users/:id** - D√©tails utilisateur
3. **POST /api/users** - Cr√©er utilisateur (admin)
4. **PATCH /api/users/:id** - Modifier utilisateur
5. **DELETE /api/users/:id** - Supprimer utilisateur (admin)
6. **PATCH /api/users/:id/role** - Changer r√¥le (admin)
7. **PATCH /api/users/:id/status** - Activer/d√©sactiver utilisateur
8. **GET /api/users/:id/permissions** - Permissions utilisateur
9. **POST /api/users/bulk-update** - Mise √† jour en masse
10. **GET /api/users/search** - Recherche utilisateurs
11. **GET /api/users/directory** - Annuaire employ√©s
12. **POST /api/users/bulk-delete** - Suppression en masse (admin)

#### üì¢ Content Routes (server/routes/content.ts)
**45 endpoints de gestion contenu**

**Announcements (10 endpoints)**
1. **GET /api/announcements** - Liste annonces
2. **GET /api/announcements/:id** - D√©tail annonce
3. **POST /api/announcements** - Cr√©er annonce (admin/mod)
4. **PUT /api/announcements/:id** - Modifier annonce
5. **DELETE /api/announcements/:id** - Supprimer annonce
6. **GET /api/announcements/important** - Annonces importantes
7. **PATCH /api/announcements/:id/importance** - Modifier importance
8. **GET /api/announcements/by-type/:type** - Par type
9. **GET /api/announcements/recent** - R√©centes
10. **POST /api/announcements/bulk-delete** - Suppression masse

**Documents (10 endpoints)**
11. **GET /api/documents** - Liste documents
12. **GET /api/documents/:id** - D√©tail document
13. **POST /api/documents** - Upload document
14. **PUT /api/documents/:id** - Modifier document
15. **DELETE /api/documents/:id** - Supprimer document
16. **GET /api/documents/by-category/:category** - Par cat√©gorie
17. **POST /api/documents/upload** - Upload fichier
18. **GET /api/documents/:id/download** - T√©l√©charger
19. **GET /api/documents/recent** - Documents r√©cents
20. **POST /api/documents/bulk-delete** - Suppression masse

**Events (10 endpoints)**
21. **GET /api/events** - Liste √©v√©nements
22. **GET /api/events/:id** - D√©tail √©v√©nement
23. **POST /api/events** - Cr√©er √©v√©nement
24. **PUT /api/events/:id** - Modifier √©v√©nement
25. **DELETE /api/events/:id** - Supprimer √©v√©nement
26. **GET /api/events/upcoming** - √âv√©nements √† venir
27. **GET /api/events/by-type/:type** - Par type
28. **GET /api/events/calendar** - Vue calendrier
29. **POST /api/events/bulk-delete** - Suppression masse
30. **GET /api/events/my-events** - Mes √©v√©nements

**Content Library (10 endpoints)**
31. **GET /api/content** - Biblioth√®que contenu
32. **GET /api/content/:id** - D√©tail contenu
33. **POST /api/content** - Ajouter contenu
34. **PUT /api/content/:id** - Modifier contenu
35. **DELETE /api/content/:id** - Supprimer contenu
36. **GET /api/content/featured** - Contenu mis en avant
37. **GET /api/content/popular** - Contenu populaire
38. **PATCH /api/content/:id/view** - Incr√©menter vues
39. **POST /api/content/bulk-delete** - Suppression masse
40. **GET /api/content/by-category/:category** - Par cat√©gorie

**Categories (5 endpoints)**
41. **GET /api/categories** - Liste cat√©gories
42. **POST /api/categories** - Cr√©er cat√©gorie
43. **PUT /api/categories/:id** - Modifier cat√©gorie
44. **DELETE /api/categories/:id** - Supprimer cat√©gorie
45. **PATCH /api/categories/:id/visibility** - Changer visibilit√©

#### üí¨ Messaging Routes (server/routes/messaging.ts)
**24 endpoints de communication**

**Messages (8 endpoints)**
1. **GET /api/messages** - Bo√Æte de r√©ception
2. **GET /api/messages/sent** - Messages envoy√©s
3. **GET /api/messages/:id** - D√©tail message
4. **POST /api/messages** - Envoyer message
5. **PATCH /api/messages/:id/read** - Marquer lu
6. **DELETE /api/messages/:id** - Supprimer message
7. **GET /api/messages/unread-count** - Nombre non lus
8. **POST /api/messages/bulk-delete** - Suppression masse

**Complaints (8 endpoints)**
9. **GET /api/complaints** - Liste r√©clamations
10. **GET /api/complaints/:id** - D√©tail r√©clamation
11. **POST /api/complaints** - Cr√©er r√©clamation
12. **PATCH /api/complaints/:id** - Modifier r√©clamation
13. **PATCH /api/complaints/:id/status** - Changer statut
14. **PATCH /api/complaints/:id/assign** - Assigner r√©clamation
15. **GET /api/complaints/my-complaints** - Mes r√©clamations
16. **GET /api/complaints/assigned** - R√©clamations assign√©es

**Forum (8 endpoints)**
17. **GET /api/forum/categories** - Cat√©gories forum
18. **GET /api/forum/topics** - Sujets forum
19. **GET /api/forum/topics/:id** - D√©tail sujet
20. **POST /api/forum/topics** - Cr√©er sujet
21. **GET /api/forum/topics/:id/posts** - Posts du sujet
22. **POST /api/forum/topics/:id/posts** - Ajouter post
23. **POST /api/forum/posts/:id/like** - Liker post
24. **DELETE /api/forum/posts/:id/like** - Retirer like

#### üéì Training Routes (server/routes/training.ts)
**15 endpoints de formation**

**Trainings (10 endpoints)**
1. **GET /api/trainings** - Liste formations
2. **GET /api/trainings/:id** - D√©tail formation
3. **POST /api/trainings** - Cr√©er formation
4. **PUT /api/trainings/:id** - Modifier formation
5. **DELETE /api/trainings/:id** - Supprimer formation
6. **POST /api/trainings/:id/register** - S'inscrire
7. **DELETE /api/trainings/:id/unregister** - Se d√©sinscrire
8. **GET /api/trainings/:id/participants** - Participants
9. **GET /api/my-trainings** - Mes formations
10. **PATCH /api/trainings/:id/complete** - Marquer compl√©t√©e

**E-Learning (5 endpoints)**
11. **GET /api/courses** - Catalogue cours
12. **GET /api/courses/:id/lessons** - Le√ßons cours
13. **GET /api/lessons/:id/resources** - Ressources le√ßon
14. **POST /api/resources** - Ajouter ressource
15. **GET /api/my-certificates** - Mes certificats

#### üëî Admin Routes (server/routes/admin.ts)
**5 endpoints d'administration**
1. **GET /api/permissions** - Toutes les permissions
2. **POST /api/permissions** - Cr√©er permission
3. **DELETE /api/permissions/:id** - R√©voquer permission
4. **GET /api/stats** - Statistiques syst√®me
5. **POST /api/admin/reset-test-data** - R√©initialiser donn√©es test

---

## üîí S√âCURIT√â ET MIDDLEWARE

### üõ°Ô∏è Middleware de s√©curit√© (server/middleware/security.ts)
1. **configureSecurity()** - Configuration Helmet
2. **sanitizeInput()** - Nettoyage des entr√©es
3. **getSessionConfig()** - Configuration sessions s√©curis√©es
4. **Rate limiting** - Limitation requ√™tes

### üîê Authentification (server/services/auth.ts)
1. **hashPassword()** - Hachage bcrypt
2. **verifyPassword()** - V√©rification mot de passe
3. **requireAuth** - Middleware authentification
4. **requireRole** - Middleware autorisation par r√¥le

### üìß Services externes (server/services/email.ts)
1. **sendEmail()** - Envoi d'emails
2. **sendPasswordResetEmail()** - Email r√©cup√©ration MDP

---

## üóÉÔ∏è COUCHE DE DONN√âES

### üì¶ Interface Storage (server/data/storage.ts)
**Interface IStorage avec 95+ m√©thodes CRUD**

#### üë§ Users (6 m√©thodes)
1. **getUser(id)** - R√©cup√©rer utilisateur
2. **getUserByUsername(username)** - Par nom d'utilisateur
3. **getUserByEmployeeId(employeeId)** - Par ID employ√©
4. **createUser(user)** - Cr√©er utilisateur
5. **updateUser(id, user)** - Modifier utilisateur
6. **getUsers()** - Liste utilisateurs

#### üì¢ Announcements (5 m√©thodes)
7. **getAnnouncements()** - Liste annonces
8. **getAnnouncementById(id)** - Par ID
9. **createAnnouncement(announcement)** - Cr√©er
10. **updateAnnouncement(id, announcement)** - Modifier
11. **deleteAnnouncement(id)** - Supprimer

#### üìÑ Documents (5 m√©thodes)
12. **getDocuments()** - Liste documents
13. **getDocumentById(id)** - Par ID
14. **createDocument(document)** - Cr√©er
15. **updateDocument(id, document)** - Modifier
16. **deleteDocument(id)** - Supprimer

#### üìÖ Events (5 m√©thodes)
17. **getEvents()** - Liste √©v√©nements
18. **getEventById(id)** - Par ID
19. **createEvent(event)** - Cr√©er
20. **updateEvent(id, event)** - Modifier
21. **deleteEvent(id)** - Supprimer

#### üí¨ Messages (4 m√©thodes)
22. **getMessages(userId)** - Messages utilisateur
23. **getMessageById(id)** - Par ID
24. **createMessage(message)** - Cr√©er
25. **markMessageAsRead(id)** - Marquer lu

#### üé´ Complaints (5 m√©thodes)
26. **getComplaints()** - Liste r√©clamations
27. **getComplaintById(id)** - Par ID
28. **getComplaintsByUser(userId)** - Par utilisateur
29. **createComplaint(complaint)** - Cr√©er
30. **updateComplaint(id, complaint)** - Modifier

#### üîë Permissions (4 m√©thodes)
31. **getPermissions(userId)** - Permissions utilisateur
32. **createPermission(permission)** - Cr√©er
33. **revokePermission(id)** - R√©voquer
34. **hasPermission(userId, permission)** - V√©rifier

#### üì¶ Contents (5 m√©thodes)
35. **getContents()** - Liste contenu
36. **getContentById(id)** - Par ID
37. **createContent(content)** - Cr√©er
38. **updateContent(id, content)** - Modifier
39. **deleteContent(id)** - Supprimer

#### üè∑Ô∏è Categories (5 m√©thodes)
40. **getCategories()** - Liste cat√©gories
41. **getCategoryById(id)** - Par ID
42. **createCategory(category)** - Cr√©er
43. **updateCategory(id, category)** - Modifier
44. **deleteCategory(id)** - Supprimer

#### üë• Employee Categories (5 m√©thodes)
45. **getEmployeeCategories()** - Liste cat√©gories employ√©s
46. **getEmployeeCategoryById(id)** - Par ID
47. **createEmployeeCategory(category)** - Cr√©er
48. **updateEmployeeCategory(id, category)** - Modifier
49. **deleteEmployeeCategory(id)** - Supprimer

#### ‚öôÔ∏è System Settings (2 m√©thodes)
50. **getSystemSettings()** - Param√®tres syst√®me
51. **updateSystemSettings(settings)** - Modifier param√®tres

#### üéì Trainings (5 m√©thodes)
52. **getTrainings()** - Liste formations
53. **getTrainingById(id)** - Par ID
54. **createTraining(training)** - Cr√©er
55. **updateTraining(id, training)** - Modifier
56. **deleteTraining(id)** - Supprimer

#### üë®‚Äçüéì Training Participants (5 m√©thodes)
57. **getTrainingParticipants(trainingId)** - Participants formation
58. **getUserTrainingParticipations(userId)** - Participations utilisateur
59. **addTrainingParticipant(participant)** - Ajouter participant
60. **updateTrainingParticipant(id, participant)** - Modifier participation
61. **removeTrainingParticipant(trainingId, userId)** - Retirer participant

#### üìä Statistics (1 m√©thode)
62. **getStats()** - Statistiques globales

#### üîÑ Test Data (1 m√©thode)
63. **resetToTestData()** - R√©initialiser donn√©es test

### üéì E-Learning Extension (35+ m√©thodes suppl√©mentaires)
- **Courses** (5 m√©thodes CRUD)
- **Lessons** (5 m√©thodes CRUD)
- **Quizzes** (8 m√©thodes avec tentatives)
- **Enrollments** (5 m√©thodes inscription)
- **Progress** (5 m√©thodes suivi)
- **Certificates** (3 m√©thodes certification)
- **Resources** (4 m√©thodes ressources)

### üó£Ô∏è Forum Extension (20+ m√©thodes suppl√©mentaires)
- **Forum Categories** (5 m√©thodes CRUD)
- **Forum Topics** (5 m√©thodes CRUD)
- **Forum Posts** (5 m√©thodes CRUD)
- **Forum Likes** (3 m√©thodes like/unlike)
- **Forum Stats** (2 m√©thodes statistiques)

---

## üîÑ MIGRATIONS ET DONN√âES

### üìä Migration syst√®me (server/migrations.ts)
1. **runMigrations()** - Ex√©cution migrations
2. **Password migration** - Migration mots de passe bcrypt
3. **Data integrity** - V√©rification coh√©rence

### üß™ Donn√©es de test (server/testData.ts)
1. **Utilisateurs de d√©monstration** (admin, employ√©s)
2. **Contenu exemple** (annonces, documents, √©v√©nements)
3. **Donn√©es r√©alistes** pour tous les modules

---

## ‚ö° PERFORMANCE ET OPTIMISATION

### üìà Gestion m√©moire
- **MemStorage** - Stockage en m√©moire haute performance
- **Cache automatique** - Optimisation requ√™tes fr√©quentes
- **Lazy loading** - Chargement √† la demande

### üîç Logging et monitoring
1. **Request logging** - Log automatique des requ√™tes API
2. **Error tracking** - Gestion centralis√©e des erreurs
3. **Performance metrics** - Temps de r√©ponse

---

## üåê MIGRATION PHP - √âQUIVALENCES RECOMMAND√âES

### üèóÔ∏è Structure PHP √©quivalente
```
api/
‚îú‚îÄ‚îÄ index.php (Router principal)
‚îú‚îÄ‚îÄ config/ (Configuration)
‚îú‚îÄ‚îÄ controllers/ (Logique m√©tier)
‚îú‚îÄ‚îÄ models/ (Acc√®s donn√©es)
‚îú‚îÄ‚îÄ middleware/ (Auth, validation, s√©curit√©)
‚îú‚îÄ‚îÄ services/ (Services externes)
‚îî‚îÄ‚îÄ migrations/ (Scripts de migration)
```

### üîÑ Correspondances techniques

#### üéØ Framework et Architecture
- **Express.js ‚Üí Slim Framework ou Router PHP custom**
- **TypeScript ‚Üí PHP 8+ avec types stricts**
- **Node.js modules ‚Üí Classes PHP avec namespaces**
- **Middleware Express ‚Üí Middleware PSR-15**

#### üóÉÔ∏è Base de donn√©es
- **Drizzle ORM ‚Üí PDO + Active Record pattern**
- **PostgreSQL ‚Üí MySQL/PostgreSQL (PDO compatible)**
- **Zod validation ‚Üí PHP Validation classes**
- **TypeScript types ‚Üí PHP DocBlocks + strict types**

#### üîí S√©curit√©
- **bcrypt ‚Üí password_hash() / password_verify()**
- **Express sessions ‚Üí $_SESSION + session_start()**
- **Helmet ‚Üí Security headers PHP**
- **Rate limiting ‚Üí PHP rate limiting library**

#### üì° API et Communication
- **RESTful Express ‚Üí RESTful PHP**
- **JSON responses ‚Üí json_encode() + headers**
- **Middleware auth ‚Üí PHP auth classes**
- **Error handling ‚Üí Try/catch + error handlers**

#### üõ†Ô∏è Services
- **Email service ‚Üí PHPMailer ou mail()**
- **File upload ‚Üí $_FILES + validation**
- **Image processing ‚Üí GD library ou Imagick**
- **Logging ‚Üí Monolog ou custom logger**

### üìä Mod√®le de donn√©es PHP
```php
// Exemple de classe User PHP √©quivalente
class User {
    public string $id;
    public string $username;
    public string $password;
    public string $name;
    public string $role;
    public ?string $avatar = null;
    public ?string $employeeId = null;
    public ?string $department = null;
    public ?string $position = null;
    public bool $isActive = true;
    public ?string $phone = null;
    public ?string $email = null;
    public DateTime $createdAt;
    public DateTime $updatedAt;
}
```

### üîß Configuration PHP recommand√©e
- **PHP 8.1+** pour les features modernes
- **PDO** pour l'acc√®s base de donn√©es
- **Composer** pour la gestion des d√©pendances
- **PSR-4** pour l'autoloading des classes
- **Environment variables** pour la configuration

---

## üìä R√âSUM√â QUANTITATIF BACKEND

### üìà M√©triques techniques
- **Fichiers TypeScript**: 17
- **Endpoints API**: 107
- **Tables base de donn√©es**: 21 (13 principales + 8 e-learning)
- **M√©thodes IStorage**: 95+
- **Modules de routes**: 6
- **Middleware de s√©curit√©**: 4
- **Services externes**: 2
- **Migrations**: 1 syst√®me complet

### üéØ Modules fonctionnels
1. **Authentification** (6 endpoints)
2. **Gestion utilisateurs** (12 endpoints)
3. **Gestion contenu** (45 endpoints)
4. **Communication** (24 endpoints)
5. **Formation** (15 endpoints)
6. **Administration** (5 endpoints)

### üîí S√©curit√©
- **Authentification**: Session-based avec bcrypt
- **Autorisation**: Role-based access control (RBAC)
- **Validation**: Zod schemas c√¥t√© serveur
- **Protection**: Helmet, rate limiting, input sanitization
- **Sessions**: S√©curis√©es avec PostgreSQL store

Cette architecture backend robuste et modulaire permet une migration progressive vers PHP en conservant toutes les fonctionnalit√©s m√©tier et la s√©curit√©.